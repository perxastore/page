<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8" />
    <title>Perxa - Articulo</title>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import { query, where, getFirestore, collection, onSnapshot, doc, getDoc} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  

        const firebaseConfig = {
        apiKey: "AIzaSyB7FJ8jzZgv4I4RW9-B6Q3U-RiZ0_ON_fg",
        authDomain: "perxa-e9bb2.firebaseapp.com",
        databaseURL: "https://perxa-e9bb2-default-rtdb.firebaseio.com",
        projectId: "perxa-e9bb2",
        storageBucket: "perxa-e9bb2.firebasestorage.app",
        messagingSenderId: "784850450102",
        appId: "1:784850450102:web:110962deb6e693aec19817",
        measurementId: "G-DMVEXWBG3L"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const itemCategory = params.get('category');
        
        document.getElementById("cat").textContent = itemCategory;
        const oversizeDiv = document.getElementById("galleryContainer");
        const q1 = query(
            collection(db, "items"),
            where("category", "==", itemCategory),
            where("status", "!=", "Vendido")
        );

        onSnapshot(q1, (snapshot) => {
            oversizeDiv.innerHTML = "";
            snapshot.forEach(doc => {
                const item = doc.data();
                if (item.status != "Vendido"){
                    const img = item.images?.[0] || "";
                    oversizeDiv.innerHTML += `
                    <div class="card" onclick="window.location.href='./item.html?id=${doc.id}'">
                        <img src="${img}" loading="lazy">
                        <h2>Q${item.price}</h2>
                        <h2>Talla ${item.size}</h2>
                    </div>`;
                }
            });
        });

    </script>

    <div id="mainCard" style="padding: 32px;">
        <div class="columnContainer">
            <div id="mainTitle">
                <h1 id="cat"></h1>
            </div>
            <div id="galleryContainer" >
            
            </div>
        </div>
        
    </div>
    
    

</body>
</html>