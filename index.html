<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="./images/logo.png">
    <meta charset="UTF-8" />
    <title>Perxa</title>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import { query, where, getFirestore, collection, onSnapshot, limit, doc} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  

        const firebaseConfig = {
        apiKey: "AIzaSyB7FJ8jzZgv4I4RW9-B6Q3U-RiZ0_ON_fg",
        authDomain: "perxa-e9bb2.firebaseapp.com",
        databaseURL: "https://perxa-e9bb2-default-rtdb.firebaseio.com",
        projectId: "perxa-e9bb2",
        storageBucket: "perxa-e9bb2.firebasestorage.app",
        messagingSenderId: "784850450102",
        appId: "1:784850450102:web:110962deb6e693aec19817",
        measurementId: "G-DMVEXWBG3L"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const configRef = doc(db, "configs", "global");
        let globalDiscount = 1;
        onSnapshot(configRef, (snap) => {
        if (snap.exists()) {
            console.log("Updated config:", snap.data());
            globalDiscount = snap.data().globalDiscount;
            const percent = Math.round((1 - globalDiscount) * 100);
            if (globalDiscount<1){
                document.getElementById("info").textContent = `- ${percent}% descuento toda la tienda -`;
            }
        }
        });



        const featuredDiv = document.getElementById("featuredRow");
        const q0 = query(
            collection(db, "items"),
            where("featured", "==", true),
            limit(4)
        );
        onSnapshot(q0, (snapshot) => {
            featuredDiv.innerHTML = "";
            snapshot.forEach(doc => {
                const item = doc.data();
                if (item.status != "Vendido"){
                    const img = item.images?.[0] || "";
                    let priceHTML = "";
                    if (globalDiscount<1){
                        priceHTML = `<h2 style="font-size: 48px"><s>Q${item.price}</s> Q${item.price * globalDiscount}</h2>`;
                    }else if (globalDiscount == 1){
                        priceHTML = `<h2 style="font-size: 48px">Q${item.price}</h2>`;
                    }
                    featuredDiv.innerHTML += `
                    <div class="card" onclick="window.location.href='./item.html?id=${doc.id}'">
                        <img src="${img}" loading="lazy">
                        ${priceHTML}
                        <h2>Talla ${item.size}</h2>    
                    </div>`;
                }
            });
        });


        const essentialsDiv = document.getElementById("essentialsRow");
        const q1 = query(
            collection(db, "items"),
            where("category", "==", "Esenciales"),
            limit(4)
        );

        onSnapshot(q1, (snapshot) => {
            snapshot.forEach(doc => {
                const item = doc.data();
                if (item.status != "Vendido"){
                    const img = item.images?.[0] || "";
                                        let priceHTML = "";
                    if (globalDiscount<1){
                        priceHTML = `<h2 style="font-size: 48px"><s>Q${item.price}</s> Q${item.price * globalDiscount}</h2>`;
                    }else if (globalDiscount == 1){
                        priceHTML = `<h2 style="font-size: 48px">Q${item.price}</h2>`;
                    }
                    essentialsDiv.innerHTML += `
                    <div class="card" onclick="window.location.href='./item.html?id=${doc.id}'">
                        <img src="${img}" loading="lazy">
                        ${priceHTML}
                        <h2>Talla ${item.size}</h2>    
                    </div>`;
                }
            });
        });


        const sportDiv = document.getElementById("sportRow");
        const q2 = query(
            collection(db, "items"),
            where("category", "==", "Deportivo"),
            limit(4)
        );

        onSnapshot(q2, (snapshot) => {
            sportDiv.innerHTML = "";
            snapshot.forEach(doc => {
                const item = doc.data();
                if (item.status != "Vendido"){
                    const img = item.images?.[0] || "";
                    let priceHTML = "";
                    if (globalDiscount<1){
                        priceHTML = `<h2 style="font-size: 48px"><s>Q${item.price}</s> Q${item.price * globalDiscount}</h2>`;
                    }else if (globalDiscount == 1){
                        priceHTML = `<h2 style="font-size: 48px">Q${item.price}</h2>`;
                    }
                    sportDiv.innerHTML += ` 
                    <div class="card" onclick="window.location.href='./item.html?id=${doc.id}'">
                        <img src="${img}" loading="lazy">    
                        ${priceHTML}
                        <h2>Talla ${item.size}</h2>
                    </div>`;
                }
            
            });
        });

        const casualDiv = document.getElementById("casualRow");
        const q3 = query(
            collection(db, "items"),
            where("category", "==", "Casual"),
            limit(4)
        );

        onSnapshot(q3, (snapshot) => {
            casualDiv.innerHTML = "";
            snapshot.forEach(doc => {
                const item = doc.data();
                if (item.status != "Vendido"){
                    const img = item.images?.[0] || "";
                    let priceHTML = "";
                    if (globalDiscount<1){
                        priceHTML = `<h2 style="font-size: 48px"><s>Q${item.price}</s> Q${item.price * globalDiscount}</h2>`;
                    }else if (globalDiscount == 1){
                        priceHTML = `<h2 style="font-size: 48px">Q${item.price}</h2>`;
                    }
                    casualDiv.innerHTML += ` 
                    <div class="card" onclick="window.location.href='./item.html?id=${doc.id}'">
                        <img src="${img}" loading="lazy">    
                        ${priceHTML}
                        <h2>Talla ${item.size}</h2>
                    </div>`;
                }
            
            });
        });


    </script>
    
    <div class="background"></div>
    
    <div id="mainCard">
        <div class="columnContainer" >
            <div class="homeBanner">
                
                    <h1>Perxa</h1>   
                    <h2>Mejor vestir en un solo lugar</h2> 
                    <hr>
                    <h3 id="info"></h3>
                
                
            </div>
             
            <div class="categoryTitle" onclick="window.location.href='./search.html?featured=true'">
                <h2>Destacado ></h2>
            </div>
            <div id = "featuredRow" class="rowDial" style="height: 600px;">
            </div>
            
            <div class="categoryTitle">
                <h2>Colecciones</h2>
            </div>
            <div class="categoryTitle" onclick="window.location.href='./search.html?category=Esenciales'">
                <h2>Esenciales - Más ></h2>
            </div>
            <div id = "essentialsRow" class="rowDial" style="height: 600px;">
            </div>
            
            <div class="categoryTitle" onclick="window.location.href='./search.html?category=Deportivo'">
                <h2>Deportivo - Más ></h2>
            </div>
            <div id = "sportRow" class="rowDial" style="height: 600px;">
            </div>
            
            <div class="categoryTitle" onclick="window.location.href='./search.html?category=Casual'">
                <h2>Casual - Más ></h2>
            </div>
            <div id = "casualRow" class="rowDial" style="height: 600px;">
            </div>
            
            <div class="categoryTitle">
                <h2>Tipos</h2>
            </div>
            <div class="rowDial" style="height: 164px;">
                <div class="card" onclick="window.location.href='./search.html?type=Playera'">
                    <h1>Playera</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?type=Pantalón'">
                    <h1>Pantalón</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?type=Pants'">
                    <h1>Pants</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?type=Blusa'">
                    <h1>Blusa</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?type=Falda'">
                    <h1>Falda</h1>
                </div>
            </div>

            <div class="categoryTitle">
                <h2>Colores</h2>
            </div>
            <div class="rowDial" style="height: 164px;">
                <div class="card" onclick="window.location.href='./search.html?color=Negro'">
                    <h1>Negro</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?color=Gris'">
                    <h1>Gris</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?color=Marrón'">
                    <h1>Marrón</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?color=Azul'">
                    <h1>Azul</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?color=Verde'">
                    <h1>Verde</h1>
                </div>
            </div>
            <div class="categoryTitle">
                <h2>Tallas</h2>
            </div>
            <div class="rowDial" style="height: 164px;">
                <div class="card" onclick="window.location.href='./search.html?size=L'">
                    <h1>L</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?size=M'">
                    <h1>M</h1>
                </div>
                <div class="card" onclick="window.location.href='./search.html?size=S'">
                    <h1>S</h1>
                </div>

            </div>
            <div class="card" onclick="window.location.href='./search.html'" style="width: 80%; margin: 16px; align-self: center;">
                <h1>Todo</h1>
            </div>




            <div class="foot">
                <h1>Nuestra diferencia</h1>
                <h3>Prendas cuidadosamente seleccionadas por estilo y estado.</h3>
                <h3>Piezas únicas.</h3>
                <h3>Transparencia real.</h3>
                <h3>Medidas claras y condición detallada.</h3>
                <br>
                <h1>Entregas</h1>
                <h2>> Escuintla</h2>
                <h3>Trabajamos con un sistema de puntos de entrega diarios para mantener eficiencia y precios accesibles.</h3>
                <h3>Centro Comercial Interplaza Escuintla - 1:00 PM</h3>
                <h3>Centro Comercial El Minuto Escuintla - 3:00 PM</h3>
                <h3>Centro Comercial Pradera Escuintla - 6:00 PM</h3>
                <h2>> Toda Guatemala</h2>
                <h3>Envios a traves de Forza con recargo de Q30.00</h3>
                <h3>Pagas al recibir</h3>
                <br>
                <h1>Compra Segura</h1>
                <h3>Al ser piezas únicas, recomendamos revisar medidas antes de confirmar.</h3>
                <h3>Si tienes dudas, podemos asesorarte por WhatsApp.</h3>
                <br>
                <br>
            </div>
            <br>
            <div class="foot" style="justify-content: center; align-items: center;">
                <h1>Perxa</h1>
                <h2>100% Escuintleco</h2>
            </div>
        </div>

    </div>
    
    

</body>
</html>