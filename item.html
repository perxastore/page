<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="./images/logo.png">
    <meta charset="UTF-8" />
    <title>Perxa - Articulo</title>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import { query, where, getFirestore, collection, onSnapshot, doc, getDoc} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        

        const firebaseConfig = {
        apiKey: "AIzaSyB7FJ8jzZgv4I4RW9-B6Q3U-RiZ0_ON_fg",
        authDomain: "perxa-e9bb2.firebaseapp.com",
        databaseURL: "https://perxa-e9bb2-default-rtdb.firebaseio.com",
        projectId: "perxa-e9bb2",
        storageBucket: "perxa-e9bb2.firebasestorage.app",
        messagingSenderId: "784850450102",
        appId: "1:784850450102:web:110962deb6e693aec19817",
        measurementId: "G-DMVEXWBG3L"
        };


        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const configRef = doc(db, "configs", "global");
        let globalDiscount = 1;
        onSnapshot(configRef, (snap) => {
        if (snap.exists()) {
            console.log("Updated config:", snap.data());
            globalDiscount = snap.data().globalDiscount;
        }
        });

        const params = new URLSearchParams(window.location.search);
        const itemId = params.get('id');
        
        const itemRef = doc(db, "items", itemId);
        const itemSnap = await getDoc(itemRef);

        if (itemSnap.exists()) {
            const item = itemSnap.data();
            document.getElementById("id").textContent = 'ID: ' + itemSnap.id + ' : ' + item.id;
            /*document.getElementById("name").textContent = "Nombre: " + item.name;*/
            document.getElementById("size").textContent = item.size;
            document.getElementById("color").textContent = item.color;
            if (globalDiscount<1){
                document.getElementById("price").innerHTML = `<s>Q${item.price}</s> Q${item.price * globalDiscount}`;
            }else if (globalDiscount == 1){
                document.getElementById("price").textContent = `Q${item.price}`;
            }
            document.getElementById("description").innerHTML = item.description;

            const gallery = document.getElementById("gallery");
            item.images.forEach(url => {
                const img = document.createElement("img");
                img.src = url;
                gallery.appendChild(img);
            });

            const orderBtn = document.getElementById("orderButton");

            orderBtn.addEventListener("click", () => {
            window.location.href='https://api.whatsapp.com/send?phone=50245274363&text=Hola! Me interesa la prenda ' + itemSnap.id + ' : ' + item.id;
            });

        }

       

    </script>
    <div id="mainCard">
        <div class="columnContainer" style="padding: 16px;">
            <div id="gallery" class="rowDial">
            </div>
            <div id="itemDescription">
                <h2 id="id"></h1>
                <h1>Precio</h1>
                <h3 id="price"></h3>
                <h1>Talla</h1>
                <h3 id="size"></h3>
                <h1>Color</h1>
                <h3 id="color"></h3>
                <h1>Detalles</h1>
                <h3 id="description"></h3>
            </div>
            <button id="orderButton" style="height: 96px;" addEventListener="height: 150px; object-fit: contain;">
                Hacer pedido
            </button>
            
            
        </div>

    </div>
    
    

</body>
</html>